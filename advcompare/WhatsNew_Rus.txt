[!] Важное замечание
[+] Нововведение
[-] Исправлена ошибка
[*] Изменения

Advanced Compare 2
~~~~~~~~~~~~~~~~~~~

[!] ----------------------------------------------------------------------------
    Человеки :-) повлиявшие на нашу Историю, в хронологическом порядке:
    непосредственно:         так или иначе:
      Eugene Roshal            Andrey Repin          g_max
      Andrzej Novosiolov       Roman Pekhov          Arkady V.Belousov
      Valentin Skirdin         Igor Paikin           Alexander E. Volkov
      Wesha the Leopard        Alexander Arefiev     Pavel Kostromitinov
      George Hazan             Andrey A. Budko       WARP ItSelf
      Alex Yaroslavsky         Vasily Titsky         Vadim Yegorov
                               Sergei Antonov        Eugene Plugin
      /    2AY ...             Alexander Lishansky   Alexey Andrusich
        персональные           Raistlin
         спасибЫ...  /         Xozar
                               Sergey Dindikov
                               Shmuel
                               Smitis
                               Hedin
                               Ilya Zverev
                               Tretyakov D.N.
                               Wave
                               Kildor
                               HaRT
                               Docent1

    ----------------------------------------------------------------------------
                                                                Alexey Samlyukov

Build 030 ( )
----------------------
[!] Обнаружилось, что для zip-архива мы не можем однозначно узнать от MultiArc:
    "На панели архив?", т.к. для папок zip.fmt возвращает CRC32=0, а это уже
    влияет на опцию "Вложенные папки".
[-] Сравнение архива с папкой - на некоторых файлах неверно считалась CRC32.
[+] В конфигурации можно указать путь к внешней программе сравнения - она
    будет запущена при нахождении различий плагином у файлов под курсором,
    данное нововведение работает только если опция "Имена" скинута.

           Несколько упрощений по просьбам пользователей:
[*] Опция "[ ] Имена" (т.е. игнорирование имен) теперь сравнивает файлы под
    курсором независимо от выделения, ранее обрабатывалась только выделенная
    пара.
[*] Когда "[ ] Имена", то всегда будем показывать сообщение об идентичности
    файлов под курсором, при этом никаких пометок делать не будем.
[*] Из опции "Сравнивать до первого различия" убрано 3-е состояние - [?].
[*] Опция "Вложенные папки": доступ к уровню вложенности теперь по - [?].
[-] Портил стек.
[*] Память под буфер сравнения выделяем только при "[x] По содержимому".
[-] Отмечались файлы при вкл. фильтре если сравнивали файлы сами с собой.

Build 029 (24.01.2007)
----------------------
[*] Исходный файл стал относительно большим, поэтому разобран на несколько.
[+] Клик правой клавишей мыши по "ОК" запустит сравнение с игнорированием кэша.
[+] Еще немного оптимизации сравнения вложенных папок - перед сравнением
    проверим, а совпадает ли вообще количество элементов в них.
[*] Мелкие фиксы.
[+] Плагин научился сравнивать вложенные папки в архиве...
[*]  ... в.ч. и с текущего уровня вложенности (была ошибка из-за недопонимания
    АПИ ФАРа, [AY]).
    ****************************************************************************
    РЕМАРКА!!!: в связи с тем, что Info.GetPluginDirList не работает с
        плагиновыми панелями из пассивной панели, сравнивать можно
          только папки с открытым архивом в активной панели!!!
    ****************************************************************************
[+] Реализована возможность ограничения вложенности сравниваемых папок в архиве.

Build 028 (16.01.2007)
----------------------
[+] Добавлен диалог конфигурации.
[*] Перемещены туда опции "Показывать сообщения" и "без звуков".
[*] Опция "без звуков" будет "со звуком" ;-) и отключает она теперь ВСЕ звуки.
[+] Alt-Shift-F9 из диалога плагина вызывает меню конфигурации.
[+] Клик правой клавишей мыши по заголовку диалога вызывает меню конфигурации.
[+] Значение в опции "Размер буфера сравнения" проверяется на кратность 64-м.

Build 027 (14.01.2007)
----------------------
[*] Теперь кэшируем результат сравнения только при опции "100%" и [ ] фильтре.
[*] Для опции сравнения с процентами также изменена работа с буфером чтения -
    читаем блоками по 64 Кб.
[+] Очистка кэша двойным кликом мыши по надписи "Ctrl-Enter - игнорировать кэш".
[+] Горячие клавиши для "обрабатывать не более 100%" и "уровнем не более 1000".

Build 026 (07.01.2007)
----------------------
[!] Плагин требует ФАР >= 2148 из-за изменений в АПИ.
[-] Не отмечались папки с одиночными файлами во вложенных каталогах.
[-] Сравнение ФАР и Темп-панели: падали при отметке одиночных файлов.
[+] Ctrl-Del очищает кэш сравнения.
[+] Если вкл. в ФАРе предупреждение "[x] Удаление", то покажем сообщение.
[+] Будем индицировать - пустой/непустой кэш.
[*] Дальнейшая оптимизация основной ф-ции сравнения, в связи с этим...
[*] Переделка в диалоге: фильтры сгруппированы в комбобокс.
[*] Изменена логика работы с буфером чтения - теперь файлы всегда читаем блоками
    по 64 Кб в буфер. Размер буфера (параметр "CompareBufferSize" в реестре)
    может варьироваться от 64 Кб и выше, при этом значение должно быть
    кратно 64 Кб. Значение по умолчанию - 1024 Кб, для диска А:\ - 64 Кб,
    вручную выставленное значение в "CompareBufferSize" действует на ВСЕ! диски.
    "SetDefaultSettings.bat" - скинет в дефаультное состояние.
[*] Возможность компиляции плагина без/с MSVCRT (см. опции CompilePlugVC.bat).
[*] Прочие мелкие фиксы.
[+] "AdvCompare.reg" - файл с дополнительными настройками (TechInfo).

Build 025 (11.09.2006)
----------------------
[*] Была доступна опция "По содержимому" для архивной панели без заполненной
    ФАР-структуры с CRC32.
[-] В 24 билде под Win9х в заголовке панели отображался "мусор".
[*] По просьбам трудящихся, изменения в диалоге-прогрессе хода сравнения:
    прогресс рисуем для текущей сравниваемой пары файлов.
[-] После альтернативного сравнения при отключении [ ] "Помеченные объекты"
    опции "Вложенные папки" и "Имена" оставались недоступными.
[*] Осуществим доступ к файлу с юникодным именем по его "короткому" аналогу.
[*] Выкинута старая реализация "Альтернативного сравнения", новая реализация
    повешена на [ ] "Сравнивать имена".
[*] Опция "Создавать списки отличий" внесена в диалог плагина.
[*] В связи с вышеизложенным пунктом, снято следующие автоматическое ограничение:
    "Списки отличий создаются тогда, когда установлена [х] "Вложенные папки"" -
    решение, по ограничению для каждого конкретного случая, предоставим принимать
    пользователю.
[+] Будем кэшировать результат сравнения "По содержимому" для панелей с реальными
    объектами (ФАР или Темп-панель). Кэш очищается только при выгрузке плагина!
[+] Ctrl-Enter в диалоге плагина включает игнорирование результатов предыдущего
    кэширования и помещение в кэш результата текущего сравнения.
[*] В кэш, для экономии памяти, будем помещать вместо самих имен файлов,
    рассчитанные по ним суммы CRC32.
[+] Будем для подстраховки дополнительно помещать в кэш модификацию файлов для
    результатов сравнения "По содержимому".
[+] Кэширование подчиняется TechInfo:
   --------------------
   [HKEY_CURRENT_USER\Software\Far\Plugins\AdvCompare]
   "WithoutCache":REG_DWORD
   Параметр  "Plugins/AdvCompare/WithoutCache"   с   типом   DWORD   позволяет
   управлять созданием кэша результатов сравнения.
   По умолчанию параметр установлен в 0 (создавать кэш).
   ---------------------
[*] Ускорена выдача результата из кэша.
[+] Подскажем в диалоге что делает Ctrl-Enter для плагина.
[*] Английский хелп теперь полностью английский, спасибо HaRT'у и g_max'у.

Build 024 (04.08.2006)
----------------------
[*] Небольшая оптимизация и перемещение в коде.
[-] Окончательно исправлена работа с Темп-панелью когда на ней размещено
    множество одноименных файлов.
[-] Отвалилось в 20 билде сравнение по содержимому (т.е. по CRC32) 2-х архивных
    панелей.
[*] Убрано сообщение об окончании процесса сравнения (когда найдены различия).
[+] Сохраним список найденных различий в %TEMP%.
[*] Опция "Сравнивать до первого различия" теперь трехпозиционная:
    [?] - сравнивать вложенную папку до первого найденного различия в ней,
    является значением по умолчанию (рекомендую запустить SetDefaultSettings.bat)
    [ ] - сравнивать всё, для создания _полных_ списков отличий (в идентичной
    структуре каталогов!).
[+] Делаем 2-а списка ~AdvCmpDiffA~.list и ~AdvCmpDiffP~.list для активной и
    пассивной панелей соответственно.
[+] Вводим TechInfo:
   --------------------
   [HKEY_CURRENT_USER\Software\Far\Plugins\AdvCompare]
   "CreateDiffList":REG_DWORD
   Параметр  "Plugins/AdvCompare/CreateDiffList"   с   типом   DWORD   позволяет
   управлять созданием списков найденных  отличий  (файлы  ~AdvCmpDiffA~.list  и
   ~AdvCmpDiffP~.list для активной и пассивной панелей соответственно).
   Списки сохраняются в папке %TEMP%.
   По умолчанию параметр установлен в 0 (не создавать списки отличий).
   ---------------------
[*] Списки отличий создаются тогда, когда установлена [х] Вложенные папки.
[+] Если [x] Показывать сообщения,  то  покажем  диалог  с  выбором  пути  куда
    сохранить списки найденных отличий.

Build 023 (11.07.2006)
----------------------
[*] Перед сравнением теперь будем снимать выделение с объектов.
[!] Несколько изменений в англ. и рус. языковых файлах, возможно повлияет на
    сделанные макросы!
[-] В определенных случаях инициализировалась строка масок "мусором".
[*] Опция "Вложенные папки" поднята на 2-а пункта выше.
[+] После сравнения восстанавливаем временя последнего доступа к файлу.
[*] Сделан перевод хелпа на английский язык, спасибо g_max'у.
[*] Доделана автоматика в диалоге (связано с "Альтернативным методом сравнения").
[*] Не показываем сообщение о совпадении путей при Альтернативном сравнении.

Build 022 (27.06.2006)
----------------------
[!] БУДЬТЕ ВНИМАТЕЛЬНЫ: языковые файлы и файлы помощи приведены к общему имени,
    т.е. называются они теперь "CmpRus.lng(/hlf)" и "CmpEng.lng(/hlf)".
[*] Оставим последнюю использованную маску в строке ввода.
[-] При длинной маске плагин падал, теперь введенная строка обрезается до
    значения NM.
[*] Загрузка масок сделана в стиле ФАРа, т.е. помним введенную маску до выгрузки
    плагина из памяти, при каждой загрузке плагина в память выставляем "*.*".
    Данное поведение подчиняется TechInfo:
   --------------------
   [HKEY_CURRENT_USER\Software\Far\Plugins\AdvCompare]
   "StartupWithAsterisks":REG_DWORD
   Параметр "Plugins/AdvCompare/StartupWithAsterisks" с  типом  DWORD  позволяет
   изменить порядок инициализации масок  при  первоначальной  загрузке  плагина.
   Если параметр не установлен, то  всегда  помним  последнюю  введенную  маску,
   иначе будет использован стиль  ФАР  -  помним  введенную  маску  до  выгрузки
   плагина из памяти, при каждой загрузке плагина в память выставляем "*.*".
   По умолчанию используется стиль ФАР.
   ---------------------

Build 021 (20.06.2006)
----------------------
[+] Выходные цифры в сообщениях форматируются группами, т.е. 1234567 -> 1 234 567.
[+] Рисуем прогресс-бар процесса сравнения (для текущих сравниваемых каталогов!).
[+] Показываем процент пройденного.
[+] Покажем еще и количество элементов в сравниваемых каталогах.
[-] При определенном стечении обстоятельств не отмечался одиночный каталог.

Build 020 (10.06.2006)
----------------------
[*] Если на панелях нет каталогов, то опция "Вложенные папки..." помечается
    как "не отмечена" и "недоступна".
[*] Строка масок: удаляем случайные начальные и конечные пробелы.
[*] Изменения в диалоге показа процесса сравнения: папки и файлы разделены.
[!] Убрана оптимизация введенная в 004 билде: "диалог с именами сравниваемых
    файлов перерисовывается не чаще ~1..2 раз в секунду". Теперь диалог
    перерисовывается при каждом появлении нового имени.
[-] Сравнение по содержимому: если найдено различие в файлах, то эти файлы
    залочивались.
[*] Предупреждение о совпадении сравниваемых путей показывается только для
    ФАР-панелей.
[+] Показываем сколько найдено различий, теперь и в ходе процесса сравнения.

Build 019 (02.06.2006)
----------------------
[!] Плагин требует для себя FAR 1.70 Release или больше.
[-] Ошибочно была доступна опция с процентами при старте диалога с взведенными
    ранее [x] "переводы строк" или [х]"пробелы".
[-] Опция с процентами не работала для файлов с размером более 4 Гб.
[+] Добавлен синтаксис масок-исключений а-ля ФАР, т.е. через '|'.
[*] Убрана ненужная теперь опция [х] Маски файлов, как маски-исключения.
[+] Добавлена проверка масок-исключений на ошибки: на 2-ве маски ||  и/или на
    пустую маску-искл.
[*] Если обнаружена ошибка в маске, то фокус перемещаем в строку ввода.
[*] Убрана введенная в 018 билде зависимость опции процентов от времени.
[+] Добавлена опция [х] Альтернативный метод сравнения - позволяет сравнивать
    выделенную пару файлов игнорируя различия в именах.

Build 018 (21.05.2006)
----------------------
[-] Исправлен поломанный в 011 билде пропуск Hidden-файлов.
[+] Всегда проверяем на равенство размера файлов перед сравнением по содержимому
    (для ускорения процесса). Для взведенных опций "пробелы"/"переводы строк" все
    по-старому - т.е. только если [х] "размер".
[-] После отмены сравнения по ESC не обнулялся счетчик кол-ва найденных различий.
[-] Исправлена автоматика в диалоге при сравнении Темп-панели и Фар-панели,
    при [ ] "содержимого", возможно было выставить [x] "переводы строк" и/или
    [х] "пробелы".
[-] Если в Темп-панели имелись одноименные одинаковые файлы из разных папок,
    то при сравнении с Фар-панелью все кроме одного из них отмечались.
[*] При сравнении Фар-панели с Темп-панелью, если среди одноименных пар файлов
    встретятся отличающиеся по атрибутам или содержанию - отмечаем файл на
    Фар-панели  в  любом  случае;  ранее  отмечался   только   если   последняя
    сравниваемая пара отличалась.
[+] Показываем предупреждение, если пути панелей идентичны, учитываем и пути
    в символических связях.
[*] Для [x] "переводы строк" и/или [х] "пробелы" сравнение идет 100%.
[-] В диалоге: при [x] "переводы строк" и/или [х] "пробелы" показываем 100%,
    а не то что было указано ранее.
[*] Опция с процентами доступна теперь только если взведена еще и опция [х]"время".
[*] Теперь при выставленном проценте, читаем выборочными кусками из _всего_ файла,
    ранее только последовательно с начала файла и до указанного процента.
[*] Опция с процентами действует только на файлы более 0,5 Гб, остальные сравниваются
    полностью 100%.

Build 017 (03.05.2006)
----------------------
[*] Только если операция длится более 10 сек. воспроизводим звуки.
[+] [x] Без звуков - отключает эту возможность.

Build 016 (02.05.2006)
----------------------
[*] Размер буфера сравнения по умолчанию увеличен до 64 Кб.
[+] Сравнение архивной панели с ФАР-Панелью или другой архивной панелью по содержимому,
    без распаковки (при помощи расчета CRC32).
[*] Переделана автоматика в диалоге плагина.

Build 015 (30.04.2006)
----------------------
[*] Небольшая оптимизация кода.
[*] Переключатель "Вложенные папки, уровнем не более" теперь трехпозиционный,
    [?] - сравнивать все вложенные папки.
[-] Не выставлялись опции по умолчанию, если отсутствовали значения ключей в реестре.
[+] Добавлена проверка "реальные ли файлы на плагиновой панели?",  если - да, то
    делаем доступным проверку по содержимому.
[-] Частично исправлена работа с Темп-Панелью, когда сравнивали ФАР-панель и Темп-панель
    то все отмечалось.

Build 014 (25.04.2006)
----------------------
[-] При отмене сравнения по ESC ошибочно показывалось предупреждение
    "Найдено различие".
[+] Добавлен комбобокс - "обрабатывать не более n%" содержимого,
    позволяет сравнивать от начала файла и до n%.
[+] Добавлено сообщение (при [x] Показывать сообщения) об итогах сравнения.
[+] Для сообщений (-предупреждений, -ошибок) выводятся звуки Windows, если
    звуковой карты нет - будет пищать спикер.
[+] Для "Игнорировать пробелы" и/или "переводы строк" проверяем исполнимые ли
    файлы, если - да, то игнорируем опции.
[*] Переписаны внутренности диалога и обработчика диалога, а-ля стандарт.

Build 013 (10.04.2006)
----------------------
[*] Редизайн диалога в связи с введением масок.
[+] Добавлена опция [х] имена, регистрозависимое сравнение.
[+] Добавлена опция поиска по маске.
[+] Добавлена опция [х] Маски файлов, как маски-исключения.
[+] Добавлена опция [х] Сравнивать до первого различия.
[+] Добавлен показ предупреждающего диалога при нахождении первого различия,
    опция зависит от [x] Показывать сообщения
[*] В связи вышесказанным изменилось название - "Показывать сообщения".
[!] Убраны радиокнопки, в связи с этим изменилась обработка:
    [x] игнорировать переводы строк        \
    [x] игнорировать пробелы и табуляцию   /   равны !isspace()

    [x] игнорировать переводы строк        -   обрабатывает '\r' или '\n'

    [x] игнорировать пробелы и табуляцию   -   обрабатывает ' ', '\t', '\v' или '\f'

Build 012 (01.03.2006)
----------------------
[*] Для игнорирование различия временных зон будем проверять кратность на 15
    минут, так как есть и такие временные зоны.
[*] Ignore whitespace и new line differences переделаны в радио кнопки.

Build 011 (28.02.2006)
----------------------
[-] BugZ#: 1215
    Интерфейс диалога приведен к стандартному стилю.
[+] Подтверждение об отмене.
[*] Немного автоматики в диалоге.
[+] Mantis#42
    Опция для игнорирования различий во временных зонах - кратные 30 минут -
    макс. 26 часов.
[+] Опция для задания макс. вложенности папок для сравнения.
[+] Опция для игнорирования пробелов (табы, пробелы, newline) при сравнении.
[+] Опция для игнорирования различия в символах перевода строки.

Build 010 (25.02.2006)
----------------------
[-] Mantis#41 - Опция "двухсекундная точность" не работала как надо.

Build 009 (12.02.2006)
----------------------
[+] Собираем GCC + Makefile

Build 008 (22.08.2004)
----------------------
[*] При сравнении файлов и каталогов теперь учитывается текущий режим скрытия
    файлов в панели ФАРа: если скрытие включено, то все файлы и каталоги с
    атрибутом Hidden пропускаются.

Build 007 (15.07.2002)
----------------------
[*] Добавлена возможность изменить размер буфера сравнения, для ускорения
    процесса, за счет минимизации перемещений головок дисков.

Build 006 (25.02.2002)
----------------------
[-] Исправлен Bug#315: "Бывают иногда файлы (см. attach) с неправильным
    временем ДОС..."

Build 005 (31.05.2001)
----------------------
[-] Исправлено поломанное в build 004 сравнение содержимого (всегда показывало,
    что содержимое совпадает)
[*] Добавлена опция FILE_SHARE_WRITE при открытии файлов для сравнения
    содержимого.

Build 004 (27.05.2001)
----------------------
[+] Перебор имён файлов ускорен за счёт:
    - использования сортированных списков файлов в каталогах;
    - сравнения содержимого подкаталогов в процессе их рекурсивного обхода
      вместо предварительного построения полного списка файлов в поддереве.
[*] Ширина диалога, в котором выводится имя текущего сравниваемого элемента,
    выбирается динамически в зависимости от текущей ширины консоли.
[*] Если ни на одной из панелей нет отмеченных элементов, опция "selected
    items only" помечается как недоступная.
[*] Для дальнейшего ускорения работы:
    - диалог с именами сравниваемых файлов перерисовывается не чаще ~1..2 раз
      в секунду.
    - проверка на нажатие Esc выполняется с такой же частотой.
[+] В процессе сравнения в заголовке консольного окна выводится надпись
    "Comparing files..." ("Сравнение файлов...")

Build 003
---------
[-] Освобождение выделенной памяти в функции ExitFAR() (на случай динамической
    выгрузки плагина)
[*] При работе с плагиновыми панелями опции сравнения содержимого и
    подкаталогов показываются не только в состоянии "отключено", но и
    "не выбрано". На сохранённые в реестре значения флажков это не влияет.

Build 002 (04.01.2001)
----------------------
[-] Первый билд сбежал в свет слишком рано :)
    Все файлы, начиная с первого различия, помечались как несовпадающие.
[-] Поправлена длина строк в .hlf (съезжали при не полноэкранном окне Help).

Build 001 (04.01.2001)
----------------------
[*] За переделку плагина взялся Andrzej Novosiolov;
    исходники переформатированы под его привычный стиль.
[*] Из исходников убраны функции, присутствующие в FSF;
    теперь плагин работает только под FAR 1.70.
[*] Мелкая оптимизация циклов, проверок и вызовов функций.
[*] Всё, что осталось от *.cpp и *.hpp, сведено в один Compare.cpp
[*] В коде проверки на Esc вместо стандартного ввода используется CONIN$ -
    на всякий случай, вдруг кто-то запустит FAR с перенаправлением стандартного
    ввода :)
[-] Были перепутаны действия по флажку "двухсекундная точность".
[-] Утечка памяти при прерывании сравнения подкаталогов по Esc.
[-] При сравнении содержимого файлов Esc прерывал только сравнение текущего
    файла, но не процесс в целом.
[-] Сравнение файлов на панелях (без сравнения содержимого и
    подкаталогов) не прерывалось по Esc, сколько бы файлов там ни было.
[*] При сравнении файлов на панелях и в каждом подкаталоге проверка на
    нажатие Esc выполняется только 1 раз на каждые 256 сравнений - для
    уменьшения накладных расходов обращения к функциям чтения консольного
    ввода. При сравнении содержимого файлов проверка выполняется при каждом
    чтении очередного блока (32K) - всё равно длительность дисковой операции
    с головой перекрывает работу с консолью.
[*] При прерывании сравнения по Esc пометки на панелях не изменяются - чтобы
    не оставлять пользователя с частично недостоверными результатами. Возможно,
    в будущем добавится опция для управления этим поведением.
[+] Добавлены опции "Сравнивать только помеченные элементы" и "Показывать
    сообщение, если ни одного различия не найдено".
    Опция "Сравнивать только помеченные..." игнорируется для панелей,
    на которых ничего не помечено - в этом случае всё равно сравнивается
    всё содержимое панели.
[+] Если хотя бы одна из панелей - плагиновая, не выдаётся сообщение
    о необходимости двух файловых панелей для сравнения содержимого
    и подкаталогов, а просто эти опции в диалоге помечаются как недоступные
    и их значения игнорируются.
